{% extends 'base.html' %}
{% block title %}Giỏ hàng{% endblock %}
{% block content %}
<h1 class="h5 mb-3">Giỏ hàng</h1>
{% if not items %}
  <div class="alert alert-info">Giỏ hàng trống. <a href="/">Tiếp tục mua sắm</a></div>
{% else %}
  <div class="table-responsive">
    <table class="table align-middle">
      <thead>
        <tr>
          <th>Sản phẩm</th>
          <th style="width:140px;">Số lượng</th>
          <th>Đơn giá</th>
          <th>Tạm tính</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for it in items %}
        <tr>
          <td>
            <div class="d-flex align-items-center gap-3">
              <div class="ratio ratio-1x1 bg-light" style="width:60px;">
                {% if it.product.image_url %}
                  <img src="{{ it.product.image_url }}" alt="{{ it.product.name }}" class="object-fit-cover">
                {% endif %}
              </div>
              <div>
                <a href="{% url 'product_detail' it.product.slug %}" class="text-decoration-none">{{ it.product.name }}</a>
              </div>
            </div>
          </td>
          <td>
            <form action="{% url 'update_cart' it.product.id %}" method="post" class="d-flex">
              {% csrf_token %}
              <input type="number" class="form-control" name="qty" value="{{ it.qty }}" min="0" style="max-width:90px;">
              <button class="btn btn-outline-secondary ms-2" type="submit">Cập nhật</button>
            </form>
          </td>
          <td class="text-danger fw-semibold">
            {{ it.unit_price }} đ
            {% if it.is_discounted %}
              <div class="small text-muted text-decoration-line-through">{{ it.orig_price }} đ</div>
            {% endif %}
          </td>
          <td class="text-danger fw-bold">{{ it.subtotal }} đ</td>
          <td class="text-end">
            <a class="btn btn-sm btn-outline-danger" href="{% url 'remove_from_cart' it.product.id %}">Xóa</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="d-flex justify-content-between align-items-center">
    <a href="{% url 'clear_cart' %}" class="btn btn-outline-secondary">Xóa giỏ hàng</a>
    <div class="h5">Tổng thanh toán: <span class="text-danger fw-bold">{{ total }} đ</span></div>
  </div>
{% endif %}
{% endblock %}